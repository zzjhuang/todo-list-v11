<div class="todo-container" style="margin: 20px">
  <div class="todo-header" style="margin-top: 10px">
    <ul
      style="
        list-style-type: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      "
    >
      <li style="display: flex; align-items: center; gap: 5px">
        <h2 style="font-size: 12pt">Hello {{ username }}!</h2>
        <button *ngIf="username" class="btn btn-danger" (click)="logout()">
          ç™»å‡º
        </button>
        <button *ngIf="!username" class="btn btn-primary" (click)="login()">
          ç™»å…¥
        </button>
      </li>
      <li>
        <h3 style="font-size: 12pt">
          ä»Šå¤©æ—¥æœŸ: {{ today | date : "fullDate" }}
        </h3>
      </li>
      <li>
        <button class="btn btn-success" (click)="addTodo()">
          æ–°å¢å¾…è¾¦äº‹é …
        </button>
      </li>
    </ul>
  </div>
  <div class="todosection">
    <div>
      <!-- æ–°å¢è¡¨å–®çš„ç‡ˆç®± -->
      <ng-container *ngIf="isModalOpen" (modalClose)="closeModal()">
        <!-- ç›£è½å­çµ„ä»¶çš„é—œé–‰äº‹ä»¶ -->
        <app-add-todo
          *ngIf="isModalOpen"
          [todoToEdit]="todoToEdit"
          (modalClose)="closeModal()"
        ></app-add-todo>
      </ng-container>
    </div>

    <!-- ä»£è¾¦æ”¾é€™é‚Š-->
    <div *ngIf="!username">
      <div style="text-align: center">è«‹å…ˆç™»å…¥ä»¥æŸ¥çœ‹å¾…è¾¦äº‹é …</div>
    </div>
    <div *ngIf="username">
      <!-- é ç±¤å°èˆª -->
      <ul class="nav nav-tabs" style="margin-bottom: 20px">
        <!-- [class.className]="æ¢ä»¶è¡¨é”å¼"ç”¨ä¾†å‹•æ…‹ç¶å®šCSS-->
        <li class="nav-item">
          <a
            class="nav-link"
            [class.active]="activeTab === 'pending'"
            (click)="activeTab = 'pending'"
            style="cursor: pointer"
          >
            æœªå®Œæˆ ({{ getPendingTodos().length }})
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            [class.active]="activeTab === 'completed'"
            (click)="activeTab = 'completed'"
            style="cursor: pointer"
          >
            å·²å®Œæˆ ({{ getCompletedTodos().length }})
          </a>
        </li>
      </ul>

      <!-- ç•«é¢å·¦æ¬„æ”¾æ’åºç¯©é¸åŠŸèƒ½ -->
      <div class="todo-tools" style="width: 20%">
        <div class="todo-filters" style="float: left; margin-right: 20px">
          <label for="filterType" style="display: block; margin-bottom: 5px"
            >ç¯©é¸é¡å‹</label
          >
          <select
            id="filterType"
            [(ngModel)]="filterType"
            name="filterType"
            class="form-control"
            style="margin-bottom: 10px"
          >
            <option value="">é¡¯ç¤ºå…¨éƒ¨</option>
            <option value="category">ä¾åˆ†é¡ç¯©é¸</option>
            <option value="priority">ä¾å„ªå…ˆåº¦ç¯©é¸</option>
          </select>

          <div *ngIf="filterType === 'category'">
            <label style="display: block; margin-bottom: 10px">é¸æ“‡åˆ†é¡:</label>
            <div style="margin-bottom: 8px">
              <input
                type="radio"
                value="å·¥ä½œ"
                name="categoryFilter"
                [(ngModel)]="selectedCategory"
              />
              <label for="category-work" style="margin-left: 5px">å·¥ä½œ</label>
            </div>
            <div style="margin-bottom: 8px">
              <input
                type="radio"
                value="ç”Ÿæ´»"
                name="categoryFilter"
                [(ngModel)]="selectedCategory"
              />
              <label for="category-life" style="margin-left: 5px">ç”Ÿæ´»</label>
            </div>
            <div style="margin-bottom: 8px">
              <input
                type="radio"
                value="å¨›æ¨‚"
                name="categoryFilter"
                [(ngModel)]="selectedCategory"
              />
              <label for="category-entertainment" style="margin-left: 5px"
                >å¨›æ¨‚</label
              >
            </div>
          </div>
          <div *ngIf="filterType === 'priority'">
            <label style="display: block; margin-bottom: 10px"
              >é¸æ“‡å„ªå…ˆåº¦:</label
            >
            <div style="margin-bottom: 8px">
              <input
                type="radio"
                value="high"
                name="priorityFilter"
                [(ngModel)]="selectedPriority"
              />

              <label for="priority-high" style="margin-left: 5px">é«˜</label>
            </div>
            <div style="margin-bottom: 8px">
              <input
                type="radio"
                value="normal"
                name="priorityFilter"
                [(ngModel)]="selectedPriority"
              />

              <label for="priority-normal" style="margin-left: 5px">ä¸­</label>
            </div>
            <div style="margin-bottom: 8px">
              <input
                type="radio"
                value="low"
                name="priorityFilter"
                [(ngModel)]="selectedPriority"
              />

              <label for="priority-low" style="margin-left: 5px">ä½</label>
            </div>
          </div>
        </div>
        <div class="sort" style="float: left; margin-right: 20px">
          <label for="sortType" style="display: block; margin-bottom: 5px"
            >æ’åºæ–¹å¼</label
          >
          <select
            id="sortType"
            [(ngModel)]="sortType"
            name="sortType"
            class="form-control"
            style="margin-bottom: 10px"
          >
            <option value="">ç„¡æ’åº</option>
            <option value="dueDate">ä¾æˆªæ­¢æ—¥æœŸ</option>
            <option value="priority">ä¾å„ªå…ˆåº¦</option>
            <option value="setupTime">ä¾å»ºç«‹æ—¥æœŸ</option>
          </select>

          <div *ngIf="sortType">
            <label style="display: block; margin-bottom: 5px">æ’åºé †åº:</label>
            <div>
              <input
                type="radio"
                value="asc"
                name="sortOrder"
                [(ngModel)]="sortOrder"
              />
              <label style="margin-left: 5px">å‡åº</label>
            </div>
            <div>
              <input
                type="radio"
                value="desc"
                name="sortOrder"
                [(ngModel)]="sortOrder"
              />
              <label style="margin-left: 5px">é™åº</label>
            </div>
          </div>
        </div>
      </div>
      <!-- ç•«é¢å³æ¬„æ”¾å¾…è¾¦æ¸…å–® -->
      <div class="todo-list" style="width: 75%; margin-left: auto">
        <!-- æœªå®Œæˆé ç±¤å…§å®¹ -->
        <div *ngIf="activeTab === 'pending'">
          <div *ngFor="let item of getPendingTodos()">
            <div
              class="todoPending"
              style="
                display: flex;
                flex-direction: row;
                align-items: center;
                background-color: rgb(217, 236, 241);
                width: auto;
                border-radius: 10px;
                padding: 20px;
                margin-bottom: 10px;
                position: relative;
                gap: 20px;
              "
            >
              <div
                style="
                  position: absolute;
                  top: 10px;
                  right: 5px;
                  display: flex;
                  gap: 20px;
                "
              >
                <div
                  type="button"
                  class="btn btn-primary btn-sm"
                  name="close-btn"
                  (click)="updateTodo(item)"
                >
                  ä¿®æ”¹
                </div>
                <button
                  class="btn btn-outline-danger btn-sm rounded-circle"
                  name="close-btn"
                  (click)="removeTodo(item)"
                >
                  &times;
                </button>
              </div>
              <div>
                <input
                  class="form-check-input"
                  type="checkbox"
                  [checked]="item.done"
                  (change)="toggleTodoDone(item)"
                />
              </div>
              <div>
                <h4>{{ item.title }}</h4>
                <p>æˆªæ­¢æ—¥æœŸ: {{ item.dueDate | date : "fullDate" }}</p>
                <p>åˆ†é¡: {{ item.category }}</p>
                <p>å„ªå…ˆç´š: {{ item.priority }}</p>
                <p>å‚™è¨»: {{ item.description }}</p>
              </div>
            </div>
          </div>
          <!-- æ²’æœ‰æœªå®Œæˆå¾…è¾¦äº‹é …æ™‚ -->
          <div
            *ngIf="getPendingTodos().length === 0"
            style="
              margin: auto;
              width: fit-content;
              text-align: center;
              padding: 40px;
            "
          >
            <p>ğŸ‰ ç›®å‰æ²’æœ‰æœªå®Œæˆçš„å¾…è¾¦äº‹é …</p>
          </div>
        </div>

        <!-- å·²å®Œæˆé ç±¤å…§å®¹ -->
        <div *ngIf="activeTab === 'completed'">
          <div *ngFor="let item of getCompletedTodos()">
            <div
              style="
                display: flex;
                flex-direction: row;
                align-items: center;
                background-color: rgb(214, 214, 214);
                width: auto;
                border-radius: 10px;
                padding: 20px;
                margin-bottom: 10px;
                position: relative;
                gap: 20px;
              "
            >
              <button
                class="btn btn-outline-danger btn-sm rounded-circle"
                name="close-btn"
                (click)="removeTodo(item)"
                style="position: absolute; top: 5px; right: 5px"
              >
                &times;
              </button>
              <input
                class="form-check-input"
                type="checkbox"
                [checked]="item.done"
                (change)="toggleTodoDone(item)"
              />
              <div>
                <h4>{{ item.title }}</h4>
                <p>æˆªæ­¢æ—¥æœŸ: {{ item.dueDate | date : "fullDate" }}</p>
                <p>åˆ†é¡: {{ item.category }}</p>
                <p>å„ªå…ˆç´š: {{ item.priority }}</p>
                <p>å‚™è¨»: {{ item.description }}</p>
              </div>
            </div>
          </div>
          <!-- æ²’æœ‰å·²å®Œæˆå¾…è¾¦äº‹é …æ™‚ -->
          <div
            *ngIf="getCompletedTodos().length === 0"
            style="
              margin: auto;
              width: fit-content;
              text-align: center;
              padding: 40px;
            "
          >
            <p>é‚„æ²’æœ‰å®Œæˆä»»ä½•å¾…è¾¦äº‹é …</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
